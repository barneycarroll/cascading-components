export default v => {
  let beginning = true
  let middle    = false
  let end       = false

  const redraw = () =>
    Promise.resolve().then(v.attrs.update || m.redraw)

  return {
    onbeforeupdate: fresh => { v = fresh },

    view: () =>
      v.children[0].children({
        beginning,
        middle,
        end,
      }),

    oncreate: () => {
      const {clientHeight} = v.dom

      beginning = false
      middle    = true

      redraw()
    },

    onbeforeremove: () => new Promise(resolve => {
      middle    = false
      end       = true

      redraw()

      if(!v.attrs.onbeforeremove)
        v.dom.addEventListener('transitionend', resolve)
    }),
  }
}
